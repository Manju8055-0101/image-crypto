import{C as l}from"./crypto-Dc9uGPCL.js";const A=16,I=16,M=1e5,k=256,v=()=>l.lib.WordArray.random(A).toString(),T=()=>l.lib.WordArray.random(I).toString(),E=(r,a)=>l.PBKDF2(r,a,{keySize:k/32,iterations:M,hasher:l.algo.SHA256}),C=(r,a)=>{try{const t=v(),e=T(),s=E(a,t),n=l.AES.encrypt(r,s,{iv:l.enc.Hex.parse(e),mode:l.mode.CBC,padding:l.pad.Pkcs7}),o=l.SHA256(r).toString(),c={ciphertext:n.ciphertext.toString(l.enc.Base64),salt:t,iv:e,checksum:o};return JSON.stringify(c)}catch(t){throw new Error("Encryption failed: "+t.message)}},N=(r,a)=>{try{const t=JSON.parse(r);if(!t.ciphertext||!t.salt||!t.iv||!t.checksum)throw new Error("Invalid encrypted data format");const e=E(a,t.salt),s=l.lib.CipherParams.create({ciphertext:l.enc.Base64.parse(t.ciphertext)}),o=l.AES.decrypt(s,e,{iv:l.enc.Hex.parse(t.iv),mode:l.mode.CBC,padding:l.pad.Pkcs7}).toString(l.enc.Utf8);if(!o)throw new Error("Decryption failed - wrong password or corrupted data");if(l.SHA256(o).toString()!==t.checksum)throw new Error("Data integrity check failed - data may be corrupted");return o}catch(t){throw t.message.includes("wrong password")||t.message.includes("Invalid encrypted data")?new Error("Invalid password or corrupted data"):t}},p="|||META|||",y="|||MSG|||",x=r=>new Promise((a,t)=>{const e=new Image;e.crossOrigin="Anonymous",e.onload=()=>a(e),e.onerror=t,e.src=r}),S=(r,a,t)=>(r.width=t.width,r.height=t.height,a.drawImage(t,0,0),a.getImageData(0,0,t.width,t.height)),O=(r,a,t)=>{r.width=t.width,r.height=t.height,a.putImageData(t,0,0)},H=r=>{let a="";for(let t=0;t<r.length;t++){const e=r.charCodeAt(t).toString(2).padStart(8,"0");a+=e}return a},P=r=>{let a="";for(let t=0;t<r.length;t+=8){const e=r.slice(t,t+8);e.length===8&&(a+=String.fromCharCode(parseInt(e,2)))}return a},m=r=>r.split("").map(Number),w=(r,a)=>{const t=r.data,e=m(a);if(e.length>t.length/4)throw new Error("Message too large for selected image. Try a larger image or shorter message.");let s=0;for(let n=0;n<t.length&&s<e.length;n+=4)for(let o=0;o<3&&s<e.length;o++)t[n+o]=t[n+o]&254|e[s],s++;return r},b=(r,a)=>{const t=r.data;let e="",s=0;for(let n=0;n<t.length&&s<a;n+=4)for(let o=0;o<3&&s<a;o++)e+=(t[n+o]&1).toString(),s++;return e},B=(r,a)=>{const t=r.data,e=m(a);if(e.length>t.length/4*1.5)throw new Error("Message too large for selected image.");let s=0;for(let n=0;n<t.length-4&&s<e.length;n+=4){const o=t[n],c=t[n+1],i=t[n+2];if(s>=e.length)break;if(Math.abs(o-c)+Math.abs(c-i)+Math.abs(i-o)<50){if(s<e.length){const d=t[n]&254|e[s];t[n]=d,s++}if(s<e.length){const d=t[n+1]&254|e[s];t[n+1]=d,s++}if(s<e.length){const d=t[n+2]&254|e[s];t[n+2]=d,s++}}}return r},D=(r,a)=>{const t=r.data;let e="",s=0;for(let n=0;n<t.length-4&&s<a;n+=4){const o=t[n],c=t[n+1],i=t[n+2];Math.abs(o-c)+Math.abs(c-i)+Math.abs(i-o)<50&&(s<a&&(e+=(t[n]&1).toString(),s++),s<a&&(e+=(t[n+1]&1).toString(),s++),s<a&&(e+=(t[n+2]&1).toString(),s++))}return e},F=(r,a)=>{const t=r.data,e=r.width,s=r.height;if(n.length>t.length/8)throw new Error("Message too large for selected image.");const n=m(a);let o=0;for(let c=0;c<s&&o<n.length;c+=2)for(let i=0;i<e&&o<n.length;i+=2){const g=(c*e+i)*4,d=(c*e+i+1)*4,f=((c+1)*e+i)*4;if(g<t.length&&d<t.length&&f<t.length)for(let h=0;h<3&&o<n.length;h++){const u=Math.floor((t[g+h]+t[d+h]+t[f+h]+(t[g+4]||t[g+h]))/4);t[g+h]=u&254|n[o],o++}}return r},J=(r,a)=>{const t=r.data,e=r.width,s=r.height;let n="",o=0;for(let c=0;c<s&&o<a;c+=2)for(let i=0;i<e&&o<a;i+=2){const g=(c*e+i)*4;if(g<t.length)for(let d=0;d<3&&o<a;d++)n+=(t[g+d]&1).toString(),o++}return n},G=async(r,a,t,e="lsb")=>{const s=document.createElement("canvas"),n=s.getContext("2d"),o=await x(r),c=S(s,n,o),i=C(a,t),d=JSON.stringify({algorithm:e,originalLength:a.length,encryptedLength:i.length})+p+i+y+a.length,f=H(d);let h;switch(e){case"lsb":h=w(c,f);break;case"pvd":h=B(c,f);break;case"dwt":h=F(c,f);break;default:h=w(c,f)}return O(s,n,h),s.toDataURL("image/png",1)},L=async(r,a)=>{const t=document.createElement("canvas"),e=t.getContext("2d"),s=await x(r),n=S(t,e,s),o=8*(JSON.stringify({algorithm:"lsb",originalLength:0,encryptedLength:0}).length+p.length+500+y.length+10);let c;switch(s.src.includes("algorithm=pvd")?"pvd":"lsb"){case"lsb":c=b(n,o);break;case"pvd":c=D(n,o);break;case"dwt":c=J(n,o);break;default:c=b(n,o)}const i=P(c),g=i.indexOf(p),d=i.indexOf(y);if(g===-1||d===-1)return{success:!1,message:"No hidden message found in this image"};try{const f=JSON.parse(i.slice(0,g)),h=i.slice(g+p.length,d),u=parseInt(i.slice(d+y.length));return{success:!0,message:N(h,a),metadata:f}}catch(f){return{success:!1,message:f.message||"Failed to decrypt message"}}};export{L as d,G as e};
//# sourceMappingURL=steganography-bxy_J-v2.js.map
